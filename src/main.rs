use ed25519_dalek::{PUBLIC_KEY_LENGTH, SIGNATURE_LENGTH, PublicKey, Verifier};
use aes_gcm::{Aes256Gcm, Key, Nonce, Tag};
use aes_gcm::aead::{Aead, NewAead};
use sha2::{Sha256, Digest};
use serde::{Deserialize};
use std::error::{Error};
use hex::FromHex;
use std::str;

const KEYGEN_LICENSE_FILE: &str = "-----BEGIN LICENSE FILE-----\neyJlbmMiOiJ3NHFkYnVxTGFHZE85OGJkU1Myc2h1NHhYK053UjF1UklXeTVS\nS09vOEZVbFJWWmhQVnRISnp0dElNejlydHhuekpnV25BcFdnaGhLRWx0WEYz\nSUdOUUtkNVNHWFkyY1BVSG1aMERBcWRIczJNVi9PbFRPSmtmLzhVRm5mU2ZT\nNEhaN1BEcVh2ZUNVQkJGaFVKa29uS0lvT1R6TVZVcDlHanRjcUJaQ2xxaVU4\ndmE2ZG5sZzZhTGhUbWJadzI2eFdxSFptRFFwU0tNU3orVy9NMmtudEh0STY3\nT2R5aHM0eVRnNmNJazNkeEU1b0RNSjRtdmhTV25leUlOSlNYNDk4V1RBQmFa\nZFdLSXVaOGhwb0gwVjVhdUpmaVhobFZ6WTdwd2pTYWFuYW9vTUhOWnZTM1dM\nV2svam1YcDZKWWk3WUpBbjhjU1QwR1BBOTc0QWNQU1ZXeWtyV3kxVHBkUVdE\nd29OUExxUExDWk5kUnkvUHJNMmNxSWtMNStNZGtDa0ZESEJZVGVWdnhFR2ZI\nTEN5aTRZZCtVZkhLMGVacWFtMEgyaElCOTAwQ0d5eW0wblhzNmVMVVFsb2F3\nVmtRVWxnVjgrYldsMmtaZ2xrR3A0c3N0d0dZcVRSZUtJUWhTcy9PTE5EVTRx\nY0VnUVYydHpQejF3Q3pqS1AxNXZCTk1UMlY4d2NYWU9ERzhDSDFvVDliMWIv\nYTJ2R0UzL3haVUxnQUVkR0o4ZkFGTG9TQ3lMaXc5WnVOS3FqZTdHTEJveWN1\ncVh1WitkYUV6UWNaZDB1N0ZWdEpkeU5ZdVk2TVQ0MDlyVitSaHQyYWMvSG92\nWGQxdW1zWUNiT2xPU2VWQTRSY3l6MlgyNFJROEx0ckRIK3BweWlYcndpclQ1\nK3FNb05MeE5XVWUvY3VLQnQ4UkhwZkg1QWpoNUpBZm5lMnh2ZXpuMm9iU3lL\nK2l1RnBtdkpad3JtU1NZS2VJOWVnNFhMdjBDb2RBRHQydjJFQ2VWTDdjdkcz\nVkZyRmwwT3cxQ05DOFAyNDM4YW1IcUJ2Vzh0SnhqcFQ3MUJvUUwrZG41QzJU\nbGhWVkxUbXpFNHN1OVJuVTJZWjZIL3V1eC9JMm9TbzYwNnhUV0N6TnFMaURS\nMFRVc1FmU1hpZG5ZOHF2S0M4MnBqNDZiNkoyRDR4bVc5cERYZy94cE9iRDMv\nVk9ZZVVSeENJSnNGRTcyWnRpdUI5WUpQT0lNVXF2dzhGSjVGM0VOUXhkNWJZ\naW8rZ3VSSGtTZk9GSEVwaDl2Zm91aDdmMHZCZG80YkdqWHJjLzFCeExDY2FF\nMG1lVS9ndjVLU0hpb3BKaTJxZnQ4dktvWk80aWdiYndIVTVLeGF2T3pLZUZv\nMnhCcU5HWU9EdHBEKzhVZDl3MVJNdlV3bS9LWDlpcjlHWEMrMUs5djZVZEh0\nT3VlcHNOYktsbjVpaTg5UFBMTXluT3RTZUd3Q0NxNEVSQ0g4dTBwYzRnNkFp\nRWw0b0dmRFRyR21jMVlsOTl6OHplRzE3WFlTTHJqbFN6bEF2VjhzOS8wS0xC\neWpQbjNYTEpPNWJhZnAwQk42cmk1SWJUaUpxVVhwZ1F6U1U5amxrc29BWHAx\nS1MvY3c1a25FVVJPZFZXY05HWWtnTnBNYUJsVFhWZ0syZ2pEV1NSOHpscWt0\ndnBnNmcyYU5xZU42dTMvTUNuWjdFRlRhNitMTzZ0QjVoVFQxQ3hTMUVLd2M2\nV3J2UmtXckVHaklxSDJySVlWZnllbzlPalZhTmh1aHc1Zkk2NHlmSklEempi\neDRqMUhWYW5HU0srV2RQQUVWRzZhcVlxYVJidVA3TTZnSi9BT3VobVlveWJM\nSXpQK0tjNmFjbXN0c2lQUWVTdU1pTW4wdEFnZm0yb0U1aTJNZkJoTnVaTnNv\nSkljOHMrbDRraHplWjBhVFRvTFBDUWpFUFBTTU14SzJFbFk2YlNNK1hhUVlT\nR2I4bUxtVG0zUHBrNFE5RWE2L0c0dG5Kanc1MHc2Q3YremM3b2dSbHJvZGE4\nV1RKekhrcVQrK3pGa2t6NWpkOXlkK3R4TGk4VkpkRXRDOG5vd0dFa3lLMFJF\nOHR6WVkyU1RtVkZRc3NHdDNBdWdzUGNNdng5c1FreFhkT0hiWHRYZjdkTUU4\nMTdHdyttajZ6Rzg4ZDdaMEp2RTh2UWdRd0wxTS9TYlFIaE05NUZHSGt0MkRm\na05oNy9hNWo3L3ZjY0pZR24rb0lGK1ZnemtmWlczZGoyWVNBYkx5YXlrLzBC\nSjVJdGovTUxFTE8xQThnQWJJc2RZS0xFRWk1VHM4ZzdYZDg1eE1pYXhnRmYy\nc204L21PeFhwVDFBQjFBRzY4RWVxTzN0V1JWeVpXK0VySngvNmRQTkNOVFhK\nS21qc2xKaGJDZm1OQTk2OU5RSFZERll2TldLNHhFdk9VM0xLY09Ob2E5NDIv\ncnVVSkdsTDJ4eTI2YmNyTnBPTThpMkpvd0t0ZE44Tm5tSHFkRUFGdDlGQmtD\nVnNLRmRIZ3lJNCtOYkR2UE5uSVZmUGtaTVFEUTNIMWVZS1pRVDhZd0JHL1Q1\nK0JKaWhxcWQveWdPais4WFM0cmxhd3lQUnViT1dhekI5Ti9zSU5PUGZZc2Jp\na2kvdTlqWitYNDZzQlptR0xJNmlUVGU4cHkwZ2FnQnhzTHpIMDExNVNjb24v\nd3M3M0lHU3hibWFRL21wQks3RmV5RURaQmRGUWdYNk5MRXBzWWRoNWVRcWV6\nSjNSSGxSYXdxVWY0NkhnVXBIcVNZbGJReVZUamtlOXM0RHhFa0xlbk9PVUxs\nRm51dHQwM2s5WVQ4b3BUbmJPSVJOckRSdFlqWDduZjRsTDZKbGxnTlY0QkEw\na0lMVHBpNEhOVXJIR0xKVzFoOHFsTFBWM3ZWem9DNU1kOEJRejhNVXlwc0lZ\nOGwzQ21kN3FpUDRjLzhKQXEyWSsxTUY4dE5VV1h0UmJKeFlsbUJ3aWhaM2Jh\nTFlQcVVURnBMaTJrQlI0cXFwZDZDaExUUlhwaDZiM1kyaGQ0dWRTc1lad3Vl\nSXJDaHpLaGgxRXZYU1JzOW5VSGFtVHgzZVhOS3MwNG55WjhJV3dWa0I2YWs5\nQzZSOU1TK1VscWdIaENFbUxBMGY3U2ZneDBkc28vZEFUNjZjTmdPZU1oelYy\nNGNlR0VVOWhlbjYrRHhZbCtack13S0dPSk9Wa2wrMkpkMjRybGtHaDdTdisv\nYndJMjdkWDFqSHlQVi91MEdkb3VVenY1TVg3L25KSGlGajVxeWl5OHJkcXY4\nT05hNDE4eXRjMkw1U3AvSXVXTWY4Y2gyVUNFci9TVVZ4S2dIb2NwMkI4UktC\nSi9pQk1VV0RNWXRQdE00TzE4bklGR0hjeUh3Q2VuaVRiemdadFNtUFZUUGVC\nL1RhNjJXbG9ZdHlWeVd4bWpyLzVCT3N3VVlvVTdxYlI2T1JWVzJid2tZci9Y\nZjdzQnd6SjYyblZYQXZoVW9jc2tQSnMzbDArZWhkTUJYVUhlYTlHZzF3ZWpa\nUkJOVStNaEpNTUhQOWZFc3JCZmpobXZnOE0yR2VBV3lpaW9seXpBYUkzL2VF\ncGFIdUM2ZTlZMitwVUFnZGEya3RXdHR6c0s3cC9QejhHMmZrQkM3V1NyeWk3\nRXoyNC9aZWlmOUx3WmI1Vndod0twSCtJR2FhNkVHeXJQTkhROVdiWlZSWUZ5\nRzh4UmRwYlJrTnhTVmNyZ3lISTNOSnVMTVVPb2cvWXFmTnRmTVZzU0FSUVZ4\nNzUya0tjNWdEL2tOdFJ5THRBdTFpUTdFQTFLY3V4OVltL0tSdlpZdkxFYUxn\nbTN2WHZOWUtYN0ZHamlKL1NGck5BS2tNTnAvaHhrRE9TZ1lwbXVwM0tDOHFU\nYVd6bkFLMjBJeGdkRzdzQVlJREYzaXlVRjBWTDlFVkJSWEZITHdiUCtmYnNo\nQTFHRVRPZ0ZoaUU2dFJoeUdSUVBSYmRzRnFDYjFLNzMyZ2dDcEkrTGxGcVNy\nSGFPK050WjN1YlpkaitXRXhWZVVYTFJDZ3BDZTlkdnNlR2tVbXFtS01jOWhm\nRnJnb0M1K2VlZnV4REVIZVVIc2Rad2F4RUNSQ1QzcDQwcy9wS0FHN0h2OXRz\nUkpOUzNJVG5KUlArcklMTHMrNHkrMmMwdG5OYU1CVDRQT2QvYTVMeDVhQ3BW\nTnpYeW9jclQ1NjdlcVRVY1FWNUpQYW96K1dLQmhocGhlb0huZGE2TFNqaDlN\nV1IxZUdPQW9LOGxSZ3lBVlB6cDZRQ1M5TmdYdkVpcWZwQWhBdGZRUUY2cS8x\nYmVneDF4cWtTSVQvMTVzRVFLYzhVZnYyaTU4elFmYk1PZHhVTGxyaTBrbWlS\ncDBHeDNncldEcUx3dlpEMnlIT0REajBvVE03ZVN2TXEwRXJJQ0JoSlgzTjJJ\nd202RzB1U3dhVS9va01xS2hDY28yNjM4Ymk0bzdnZWlnWXJJc05HaE1JZXBt\nY0N5NmJrK01uYkFyVk1xTGtjWVhBYklibjJacUJqaHBHamFRWlNGU0dqcWFv\nVDgrVXZGWXk2elBxdUpzRlpST05UR0hOcGx3SUdkMFRpa3Rsei8yVi8zTWJv\na2FEN05Mek1YR25FOStobElMU1Y1M3l0Rkw4TVg1MDFlN1QvVWZrcHQ4MEky\ndkMyNVBFMHh3azN5YzZ1TzhZR0dxUFFLM09XSk05RWJ0OWhUN2JQQlJDNDgx\nbzJMUDl3cngwYm50eEtZVW0wcEN6TitmOU5DUUk3VllkN3NoK3AwV2p5M0ty\nWVhWbFBKVGZtRkJwTU5KTFBhMTJVNDVBK242aDUvOE8yTXcyMkNzZ3haaEt2\nSCtra0JpL2VmSW80ZWp2WDNoWWFRU1IwU2RiQnE2NmpJNEpDUEhsVGM3c00x\nVFVBbGVkdUhDYWgzSXZYb2Y2cU83SVhMSzFsY0dmaXIvWDdZYTU1VEhEa2VL\nSEk0eDlmNG9uZkoybFhDL3h2ZEM2bUpKYVNjOFlyakNFWExIL0tZdnZXTmE3\nUGY3NTNYUmV3T3Z3dDFUaWJrZW8vZXlEdmJKbkJLTWxGanpyeis2SE5aSXpo\nVGkyUUYrSVFhWGtmcDJMbVhKRjZSTEwvS3hiUGtzdXIxbW5jQnJ2dWQySkJU\nZnBVRW94ejIrMkF5TE1WY1E0a3dqNHhGZGJkcGE0clNHK2hnMk5wQzhzTmcr\nR0JKT0s2NlVSaDlPRWNQaVlvaFBPV2laVjE4cTdIY0FqazQzUUZHVXdZN21v\nVU0weTdMMkx4ak5NYjhtRFhGdU1TS0dobzJwa0JtZThVR1ZKNm1KM2pIaGJn\nMEdkRzFlR081bXQ3czF2SDB0dkJsckhseEVSdEVvbDlvRWM1bkFTZVBDb09F\ndE1hUkRmNmlhV0hoaWhIZko4eU9iKzlKTDlvaVJLWTBoWThmSnpHWkRyVmlZ\nd2J0Z3NSNCtxMnRpVjdjNzFzWEFMY0xndDJPWWFFaDFGbjlnV21uNVlYb0Ft\nVE1sZEtUQUc1OFVDMGRwYjVuZUtCMDBTZ0pBVkdUa1VUN3FEeTQ2cmtneHlN\nZFowMWx4VHhITUlwcElsNjVnUktRVlg5Lyt0bUpxUngzR1ZPbGpxU2UrdENK\nZGdBM0VTVmZvaEptd3dCN1JFeWs4UnE2UEJqaEcvM3ZrVStrQUtTVndCaFR5\nWCtlTTlRd2pxYmhCeFp1K2tnSG5HeHZjd0d4NWhCUUZLaHdMMGNCNlI5MW45\nanRlNmxVb1ZkbkRiblljbTlXRkNhdk9RM3p4YjdlOHgzbVlveExpaCtJajMz\nRDFaUmZEcXVsVVdxRURUUGdWcldPVkdsTTE2NTY3NW8xM1FrelloRWk2TE9l\nd2tmTjBTK0tDS1VNOHEweWdKQy9hY2l2UWRFNTNOTlJvWFFNWXk3NUdSNkVh\nT0NIVGtONDM0enBuTzk2bjZ5a0FCc3ZpTDUraFE0eFZyWmFMMFQ0cWVuYkRk\nNmQvaG1LWEpzc1htTW8xeGh2NENpMTdBZlVmYi9nRXVJZEZuTFdHcmc5VHFR\nMHlOTDZxM0lqUEZHNVFjUXp4dmp2all6clYvKy9GcjNGU3lnbHpGZ1Qwak1Z\ndTNqd1g2MFp2Und6NGY2dDJEcDhsaVppRDRRWFhGSFhrZzh3RmN5cHZELzZr\nN2ZCaGRWN2xyQXJCbkhlRVp4SEtGSXBncTIzWWp2OGdJSFJvVFcxMjRoWSt1\nV2t0OTNZVXRSY0FHY1pxZHBLdEpWYnFJZEhxRTdXa0RnZFYyNnUrT2FhTXJJ\nRW4vWVpkcDh4bHBrRUx6SFFKRG4wbG1aaVJkN1UzT2xlc1BaZkgwMEl4NXJy\nL3VPbmxpRmdhd1NtclNMSFZPZU44NUJiUFErdzZQNXdtNVNVcjdyajluczFI\nQzVzWUJqZWNJdU16RjRHY1dlMVQ1L08veFBEZXZuSm45OW1Ra2RzeldYNDFv\nTzU4cXlOZHhhcmh1U1dHWmpjMW1oRzFVK3RhS2FNS1p2VUphN3ZpQ0U4Viti\nKzAzVkZRa0MweE1CK2JaRHh4eEdvNWR2aFNkeHczRHgweE55SlU0UDZuVDBB\nRzU5bWc2VWVzcEpRakZBRG50Q3RwTkJ1dytzbEgxNXVKRmxOQ014S2EwM200\nckZWTXRkZ0RzMnR1a096WW5kNjF0a3YyQUN1cDlwTldoQXpjMjJLcnpyQnpF\nUFdwcXBaZnVsZEwzZVF1NTJFZVEyQlFYT0V4Q2NrVGxoTHVrN0NCcVVBNUpr\nOFpGdlI0SlNLMnhXSXZucU9IUFhvVUpTM3JVdzllMGVpalQwbU5sY09TNklJ\nUkd2VkZyUFRaaDhtR0RiZVlISFBwVmU5dGRTUUN4NENkNHROc011c2NDa3Z6\nYzZMVjdreHNEcEFuL1B0dVVGT3hEUkJNZnhDY2hYVHhyRFVoeW5qSlcwRzNJ\nRE51a09EV2pZckhaUVdrTmVRUFVQaEhtdnIxMUVGYXc3dTRENzUvT1BudWtQ\nMDZ5N2NVdURROExnbjY3TG0wc1U5cmM4LzB3ZDhoanBZbS9zY21tSlhaaVpZ\nMGhKTFE0aC9IZXQxbmVuUWlZaEQ4L0FuekZKVnlWOEFLYXBPbTJQWURJeTl5\nbU02dElwT0M0ckhCMy93WTNacnoxaENuRTJmV0ZyYUl4STdrUWwzaWNnUHlL\nWXcyTWpDT2JCbjVKSFhJN2w4dlhxMzJOcTlEYVZDR0MreG96b1BUeXJQazNN\nRlN1d05IS0gxSVVZb29oNTRWamNuUFFBNDZVMWkxN2QrcHVJeDNUYlllSnl4\nTWhpcGJPaXdjQWdWWVVndzI2aE04RmE0OThSb2hZbm9CRzRsM3cvajgvUUVI\nMTFwUGgxVk5rWVRSUGZBNzVQaHRGdjNkdDJaZEg1elFQMW5IMkQ5S1BUNEdM\nZHZWSDJpTnNCQ2ZTamFaNlZuSzc4SVZ2ZnFxMWtIbU9pMVZhb1ZpaTE1WHY5\nV05weXVpcHZsMTczd1J5UDhFcCtSVHhLSzNESzd3ZlFuQUx4eWFualR6d3Fr\nSURuNmVacGtkWG4rRVZoNW1md3QrTm03QTNtSEhKeWpodkhZUlQ0MFN5SnNz\nZERXZzF0dmZ4aDVDWnFpZFBPdXJ6MzZFWExVS1BHMG5MMG1LM3MrWUZ4Rllt\nWmZJMWhQWUdFTFJsV0ZueUZGbnJqaFpOaUtyY2puMG9lZlIzWDJkeU9KT1I0\nUXh6a2Q5YStWQXFnYmRYMHJmVDZudWd0UnAwbzg0SHE3N2tTSkM2RFgwRTlK\nQitkbko2M2VpOVZLeVNlbWd0Sm9Sc2ZXeHZsTHcxVmNHOTVScUdoQ296UVM2\nOEJnbE8yellxMVY3NHJNUVFiYWN0c3NnZWVYM3hHeEdUenA1NCtLUWNVOXRa\nMklGYUxwTW5CVVBLaW1jaVVLVUdWNzRMbmc5cVBLTk9EbHlPUkVGeHltcEY2\ndzZtdzZkNGFGMXdrQXhjT09vcUhWTVJzY1hUNHB4QUF2QUlra0phNlFZb09M\nZDd4UTFaWTZOREdNWTdlMTRaUy9oNmlCREREekRzVnRMWUJKeGNERzdjam9J\naGhWbXFlSmNlclNjdittSE5PMVdKa0pybFpKUG15MHArQkVzOWxCbDhTc2g1\nNW9vNFFCR21lZFRTcW8wSGM5MXpteUZ0cElNRFJCL0JReGZRNzhqSEdXelBs\nNENNK1M5eml2UEkyWXZUZkpreHFJZ056SHpLWjllOUw5eGFLVmgzYlVkVUJz\ncFZqMGtpWVY4bXNxejN3Ymk5TUJyRkpTNW5wZmN6ekVMT1FUZ1M4bW13MFRL\nMGVXR0lKOTU3aXl6WjRpQ3dDNmkrdTZqUTI0eDBaOGllRkFOUDl3ZzZVanJT\nbGlSYmgwWUVpZWQ0ei90dDhML1hERnY5RDdOTllRZzh3MUI4MWdya2pVZERU\nbElWYlBoWWhnUGwzQml0SFBnY0hlbGF2ZEg3NGhDallmdElCZUZtZHpQOXR4\nS2ZQSDNYekNFWU5ycmM1ajRLQjFuNzF4RGJnOWhQREc0UFFUWnpvazBDdWtI\nZkVIeTBXdy9YYnhuV3Z3Uzl6VFB1OEVkMml2YVltTXArWS9YTnd5aWM1MnJE\nb3lZamdIL1RtOXhYU0pkWURxREJMalZTUzlJbTR1YTRuQ3JwbGNVSFNhSFlq\nZzNMd0VJMld4WVlTR2I5SDRRajl2UVg1VG5rZXd3aDhaRkpBSDZPR3pCWURQ\nenI1cmpxNjNlb1V5YkJXdE1ZTXdRU1VkOVZPZHNZd29MTEoyeWZHdWhzL1pl\nellyaDdyYWU4MXl6eUo3N2VYQ1FobGQ3Tkg3Unhmajh4Yy9rYWtBeVp3c1pR\nTDNLZXFHeW1DR1NVVHJRaThZa1EzcWlodks4VVFDSjNqejZJa25MZTMrUjdR\nVUFuQnU1S3BPNHBzSHpmYy91RUQwNFltZ0o4eUI3L2tpOUQrYm5OK2JlNXpr\nOVYwOG1DWHM4M3R0TDJBL3ZjbitYOFpqeVkzNjc3V3hPcnVsbC9UQlM3cnJz\nOGw4UURpM2t2aDFlQUE1S0JWUlZhSklhVUVWVTZNRE9ScXU0S252c3ZOWk5S\nQysyWVk0MFR2UXU3T0hKRS94Z2dBdXFGc0NjckpLMzIyaEJCdDlmNUdRWTY4\nZmM2NkcwRFZ2Vk5pdFhNNUU1SDJYVklaNk9RY3JyUGtlaG80b3FFTUI0cDdn\nTGFMbXFiVGdxOUNnSGM1Y2l2bnUyM3VvbW9GaDMzNzgxTVNYMGllUG9xcmp1\na0kyMW8yUlpBQ20wcDJwc3ovNGlVdjhyM3RHR2tnM2l3aGV2a2JrVUxnS0lB\nRVBDRyt0VmlWaDh2dEozMkVQdWJWUXg4T2V3aHZJSndjdXRaSW0zTzJIcW5Y\nWHFIRWhKKzlYOEdnWVpjZUNiZExHaFZKMm5SV3V4WUpxWi9xclJOLzR1MzV0\ncGIvbDd3c1Z0cWRaS2dBMmZEWFhEdERHYUt2cHJJOXo2NWROT1FBNDVybnBk\ncDJrWHdKVDVPQVRhMUJRd0xqWjdYcTdNSEJDbGs4dXFEb2Vnd0dyZzFZUmo2\nZE5tM0J4cUZMeEQzK0ZVRitLVXlQNGxhTzNxUjdmY016aldIYVNxa3lyM211\nTndXQ3FOeXFBWll6NmlGQVJTSWJUVFBjaGkxbTBWek1MNVdlYnJNUGg4TTI2\nQ3RpZndrbDhSRTd4WW40NEo3RGI2eG5Xc0JhTjc4UUtNRXRPT0RLY1R0Mm0w\nM1ZqanB4M29UcDhBUlJ3c1AzUHdaNmNsZ3RGRGl2UUl3VHo5bjd1Q3VHc1ZG\ncC91S1dobUlWZU5uNXNsNFVrOGJ5ZGVRY0RUUXkzQ25KNGc0T1lnVisyL3Yy\nV3VJMDlZNmtBbEtVU2FXRmtsUjRsbWVTK3BMNmNURUJabHhOWU9oVy8xcTFH\nYUxUY2t0NGdWc1UxT21XZFlmcllvNUlnLzZJeUx5cnZuNjhxQnM0Z2x2SFN2\nTzR2d1lnVXlXdlBUeDc1c2lkV0lpWmRtTWd6amJMTmo2NHFhaFZCV3RYdWZx\nSm45YmJ6WXptRzI2VHVmTWdYZzg4UFZkUWpkbzZPOVBCV1owREJjdXYyQWta\nUmtodmxDU1FzbTQwUDVyL0ZLaUxlZzVIZ3hzbzZCUnV5R21tMURKWk80MFhZ\nRWRUcjVhdkk0clpjZjlTY0pqdDNjVWhXMHFlTmpVazArVU9oMFlTRDh3Q0Jt\nckxDcEpHOEF0UXRQSUpFRGp2Z0NJSmdJZUwyakhZNjk4UGtMUlFCeDVONkVo\nYXZvdUN2UW1oTHo3cFpmKzluaFlHSVhwS0NVd0xLdVo3b0c3b2xyMVdHWS9v\nTG5Iclh2eXlick5CZklKZHhEVWhMaThCQURzUlg1dGdKZnJJK3U1UWJhU2JJ\nd0NyNmhJRXFpVkNpQk9VblNZSDM1R1VNdmZMNmZaekRYcm5md3pFUWVLYkh5\nVEFPcWY2Q2k3OEptdDRwbGdOSDUxWjhFWjZKUkJHdlBVVHEyZzluT1ovZnlK\nZXNvNVVYUndQNnhCeXdrUkpYcVBsamdwUzFjVmpxaVRNNk1PKzNpTVVYTW5M\ncWszNnJBV2xCcG5oZlBqbmRWOWtKdG91NTZZQzZ4R1UzcmxFc1c4ZzhNOUQy\nVEp3N3M5bHo0aDdCcnhESFhmUTIrMjRLM1Exb3dyc0s5NWVLaUhqVGhBTWU2\nVkVoc09OZmtnYU1aM0ZoSjAwNjZWdTFDSDU3SzlDdS9kOVl6SDd1MlNOby9S\nbEpqL05JbmUyUGJTVWhHWWlDOTZzbUl1UkNMQmNWM203OFpNRHBZcUdUMG5m\nNE1NUWdsWC9RbmxYNFVXVERjTkVKVzBBL1BEdG92VDBQaXM2QWQyY1o3NGVY\nVVE5emEvNzh1SmhQQTNqaWo0ckJnZWNVc2k2Sjc1a2pCSUwvZ01ZQ1B3NGdE\nMi85QXAyQlR4WnFKckJlQ1dURzVXTENPRTFaSDJqb2t5OXFDcHhJNm9mT1Js\nRGk4U3NVZHBOc1MwakJncmFJczRNR3BOQzFuVUk0K2Y1L0JDT3BFdFVsUnlo\nZWlWVGNkWGFCVHNScGZpajNZdUVPck5kd0hDQngxeUVjelZ4U0FIeWcyOFZ2\nZVJtbGlqNzgwOWJ6WnJQZkJOa21YZGE0ZnFmMFVyaFZkQVdsUGtuWnZwTjRy\nSGJCMUJLRC9LM1p4aWF3TWZ1Vm1GWmpNaThwT2h2cWJYZ3hJRjN6SXV2UVJM\nbHJNbGg4aXhoN0hyVFdReHk5VGoxVTlaOFNpOE5keG41cW1IdFlLWUNOcHp6\nYkpxSDZORThrNlEvZy9CU2pPVkliemcvZHp6cHBZZ1VJNEZrOGlVTGlEUlN3\nQzF5MEdDYlBFbFY2dUlZTmxTQnhRNHU1UWZERjhXMTBxcUdDY210WDlLTkVq\neGN5alYycXlpS2R0ZGthR0c4RjNZNEFaWkZ2NnhZbFQ0YTBaNzBvUUE3dkhm\nS0RuTC9pdEVoQVYrK09YUUNFdzRlaE1DVzh2MUROMXd4NWJ3ajFEVVUwVVRZ\nK0RwNDFyT0NhMWhxS2tXSHZjeVF4L3M3dG0vNjYrdndWc2dEdkljd2JGdS9V\nM1pXa3FEc2UvTE5UMzZkLzdvSmR0cjdHN3dFYUxoL1NRaE5NaVVtbHVISHdL\nUGIzdU1NY1AwMEMwckVTdStEc2ZORmQ2WjhleHFpZUJQVUgxOEgwcU9GaUxH\ncTBNeUp0SnlvcVdlSmtWd1pyNHladXhpTHV3M0loZG9TNGg1K2tiYnVsRFRQ\nR0VTaXVnUVNSd3A5dSt1b2JGWkROMVNMWW1VaU5BQUpITHhXWjlOejVTZ1dD\nYzZRZkNmM1QxOEx3bkEySTl5b05CRkloVW9WZ21nbkp6OXVmLyt5SXAvMHpo\nZDRRWnR1WG4yTDM0eGdxUCtmeWJ2eXF6N3VhT1NSYjBlc2xqZGNLNFRQY0Ju\ndWFvaHAxODM4TEhZRDQxbVBSWW5mbUNGdDFJQkdnUXlkalRVMk1TWnNNZnRw\nai9sKy9PLzhGYlpiVWJlWlcxVkM1bzduZTNvYkFZN1JqNlIyUEtmVlNUY2hq\ndzZvQldBY3lMMUFCZWFxbzd1L0pDaU11M0hwczFRWU9DRUNpYkk5a0lhRGdV\ndEY3eDgxdkQwVEhBOUhUdFZWc1RTTWx6NG5GV2p1YmptcmpyemYxYlNBRDlN\ndFlUUGszNmp1RUhWNXhiaXJ1SHdiM0tmNVZZQ2lxTW9ZRUxFWUovbnJqSS9B\nZ1VaSWV1c09kNmZtejhlckxLRWlQRktsNVFvMU0xN1RQT2tpV25IY3JkU2U4\nOHg1bWJ3U09KdEMyNGw4aXdHTnU0aU5kVC9YekFWVU90SlNoODlmRVdPSlVJ\nVGFDVWNIZFhRU2hMRE01U21JeHFTNHI5eXpUWDFEd1pSMzVoSUxwcTkyMk1G\nSWJDTTREMzBmek4zUXova2hGVnhxd0pjVkxmYm05NExhcTVKRFM3bk4rUFBa\nN0sybE1Iamhkc3ZsUXMyOXE2a2xId2k3dm9wSm9jSm5xcGtad003SFA2N3lh\nK0NOMFlTSytMbHZOeER4dTZEMTZGUG5rTVdRUzk4eFVrOEQwemcwK2doODNw\nRkZYb1BteEtsZ0lSYllaQUp0eWhmeCtlRzJ5TG9Ba1BaNEtudTVMbnFlaDRO\nanhVZDdUZGtaYVh3dVFiKzRWUGhOcXBaRDdFcHpXdlptMytBbDhONG8vZ2wx\nZ1ZVcnREbndpK0NJNms3RzlwU0grYzFJeWxQR0I5ZzVhYkhIcFg2UDl4Rm8x\nbXhRdGs3R1VkcXhFM1NtYlZ4aEs2dlV2bG9wZFViZlhFZEwraGU3Q2hrS05T\nYUNpSWsreWkvbUZPSk5aZGJ2RnV2WnR0Y0NoWXB1Q29nRHJaN2pOb0g1QVNX\nb09kNUdRSm5VekpOcHQzY3dlR3NtVWRFM0pLRE9Lc1ZyTDJxeTl6azBnYkNu\nM25hejdabGJqMlFPOG5aU2FzZENIcVpRVWt1WFJVRmdpdFZXTW4wV2FWZ01j\nQ215NUdNY1hYQmNtaHEwM3NEZDI0dEJ2VEt5cHExSThSclJWb2tTZGtkZ3hr\naVF4MnlNOWlUV2xTMThkTzdSRWp6Q1VXanZ2b0h4VmJnSGhPY1pkZnJDbUlq\nZDFFVjJ4QWNSLzdQTHRJa0EyWXNQb3JGa3BtTUF4NGZKT1A1MTlaMEp3RWp4\nK2EzM0J6U2UvWmR5c2taWjhpVi93Ti9mR3FwUkdVNmNwVGhiNnVySFQwWkRL\nZzhzUno3WWlsZm5NaHJWM1c5OFhQWTZ1SVduMmZBR0RSZTQ2R20rVDZYSXZj\ncWFhUEE0cGNlOURxTTRZRnhYRDFNWWpHRzJJcjVJRU1nVlRqdlBSd2xjNXV2\nUE5od0o2MzlNT1g4V3FtRHVQZC9XSE9hOEdxYlNpYlptUU1QZWVpcjBHLzlW\nQklrVmlQTzI0Yzh1OGoxNkxsa2tpOGdwdXNpYTVBQjFGNnY5ZGtMRDlqY0Fa\ncGduTUtuMSt6cVNwZHNzZmR1RE05aXpaMlMxOXZqdlFhOXQvL29RWXU4S0s3\nNTZyY2tTeUJPY1NXQUpTWEtYVnVWblNOZHNHdllmZ2RBT0t5OE9ZRDZtdW1T\nQ0ZWUnFHdFVNUWQxWjlXNFJaUitsc2xrL1AyekdBTStsYXR3VytOclZmQTVi\na0xydHRxM3EraUt1YVZlVFpmUjgxdTJLampPVVN2eFVQdEFPazBNY1U1eUp6\nTVV5djBUVWJuME5idk9jWFFDQWFBZlBsU3VRK3EyM3dRa2duMXdlQitySCtu\nRFFmTkMwc3RjNHpYdHZENlhXL3Mzcm1FcXJWa1hrUWFKSCtsN0RNT0hyZ3VO\ndmROa0wrZndweS9GVlF3RWx1Qk5YUnN6S2kwK2RKTFNPL0l1bTg2dEVtdzFS\nekM1TFo3SmJoWXFYMkNwMXZpanUvQndvSit0Ri80WVlsdW5RVk5Da1NEdlR5\ndDlBSzFsWkVtVjNIK3FjaFR3aUVZeGFtYi9QYTFicSt4U1R6cmZMb3NicHJL\nRUpuM0dUd2E1TGludm1Eb0l3cDNGd0d2TjlvYVFhN1dpV0NVelpXQmorNkkr\nZ3JBbXppbTdVRHZPcXA2YmZ3SWFOajVjdnBuUzZVRVNBdms2RmNXd1dkRSt3\nZ3djNVplL1dXYTZva1gySndDaDRJYnF2WUJMdHNEekZMZjNQVHVLWFUycnNj\nR3N0Q0JIVG1xSnZNVjVKclNGYWlHZzhCVU5XOE9hYjJNUTdQdnhHTnBYQnhi\nRS9EQ3Q4MlA5L2MwL0ltOTQxYWM3ZVJsNUNCRGx0bDl0K3lXckx5a0dZdDhu\nb2RNVGtubkU5eHNqUEljajNVTjVHcHMzYy85TkJhK3FGYW5KNWsvQWNkT1ZD\nZUNIeHIxZFJub3cxR3lkR2pQUUxjKzVOTUpzNGE3UzZhbzU1M2ZyaVFwcStG\nWHpnS1pjZGorazVhQnJnVmNGY05LNytSTkUxN25hUDI5eDBPMkhkSnZrKzlu\nNG1jaVZTbXpZQ2QycGl5YUZQZnJUdkUyN3JpdkhTWWpLdTB6TjBycmVuWFh3\nTXNFY1FRcTJvN2w5UytYNmV3bWxUTVFzS1hPc1g0SEFXdnB3YjZOdG00U1Mv\nNjREZngyRVF4endBM0pCaFFsMkJqck9hcEZjWGpZZ004bzE3bTlPZUhXbGZy\nTkF0TEttL3ZkVm5NVndHeDZsL2RkUUltdjhBTXBEUzNuOGNvbjVwL3liaHd1\nbHlFejdycXU2YWwwaWpJL0ZqbW81dVFjUGhFU09RWTE0N1Y4Vm16V0RzR2NO\nTERoUzFFNEE5VGQ4VlY3WmRWd3pVZk9zLzBLVmFrRGJhQnRpSytqSzhCMStF\naUdLbXBQcmt0TTVpTnRpMTZSd0NIVDY3ZXhyMWlSZUE0ZktBZTNyU3hSdm1w\nRmJRMlI3R0hmbzZVTFRySTkzN1dOSit5ZDY1VzNLdDZSaEE3SGxkbm9BdW9i\nbmFpNURpUzZENGJkYUdnRFlLNTQ0bGdJYWdyenpScTNXZnVFVnNjaVZOa2tn\nT0tsN0gyOTNYZVNJUlByTEp3cC9IZEpyeklTam9Sa2JsRXFQTXZYa3ZTS2Fp\nQ2pKOTNGQXQ4RVdXZXhGMjd3T1pJbDIzajlVRUpwZzNqMFhBc1E1T1dTMHUz\nVzdkYjNKbHdyLzdlNUpScEVXcmtaU0MrT1I1ZTlycmRPKzBQSWZBbWIrNGN6\nblVJV0dRK3ZlbkQwNzB4WlJsMjJGdEVCQ2ZNSEkrK1EvejdBbDNML2pMc3M1\nakxBczd4Z2R4UmduL1BMRmhKV0FCWllqUWhnSm1UcUF3c3VEYnA4dlgwZDhS\nN3pmSEx3aFR5K3ZvbzhWV2dYYUFsb3IydDlUeDgvenA5ckVrdnptT1lsTGo5\nOG9mLzZtZTV0VTU1OWxtOVFJdnFUT25VNGRGeFd3UGpPTk91SUtMNEV2QVVQ\nbUovU0dxL0lmbzRiNmFFdjIvSUxvN01QS1lRSmJJbDhsUFlacXJmdjNzN0xv\nUDlTTGZ2aEN4OGZqcU9hOC8yODl5RWd6Vk5RanFVWUUrekZNZ0dYVnJwNlRG\nbEhRb3MybDdOcU9vb1VaR0ZmSXByQ2ErL1ZFSnA5WHFMbDk5STI1bURZbTJB\nclVjV01FeWtkMW5mMWdQQ0MyMFFPTUMranpGMklvSnJmZWlhYmFWbjR6c1d0\nZEI2clZsMVBKWVR4VzZyQmZuYmoxUVd5MUZwd2NRUUlBSVFBTnZhanZOcEYy\nVXBrOEEwMGJxWGFKQVhZV0pNR2hZM0MxZ0h4WllzTmhnaVNIZmU1V2VNa2I3\nRklzWlpoSjlnaFBwWUVhMGp6OTFQQjlCQTlweE5uR0hJSFprcDI2R21jZk4r\nbGF2ODhjMExYMjNQYjR2QldtZi9UWEFZZkVvaFBlV3dHYm9tc3hTTUg3eUtw\nN3F1TklqUUNpRy9zZU9CbVBnVk9kRk9MaXZNRWR0QTNWUHZualhYYmJqbWtR\nTVMzSysvVHRSOTBGZUVtTFNwc08wb0c5SFVhaWtJeTNONzJCM0pkVURjVkJ2\nbGw4VFRKd2dEUldvb2tJb2QwN3JhU2t4ZTQ2V3VOYUJZWWhYQkhCYVRqckhG\nL2gwR1NZaUhvd2JFWThOWjFwS3Vac2NleUMxcWlma0YrbDJ0N0tYZWFZek5a\nN1pBMEQzbW89LndwdTFUZGNIVm5vOHpnUEkuL1Z6eFRJQThzRnEwQml4MGxq\nZGZ4dz09Iiwic2lnIjoiZ0NlMGdTNjdvcE1jOXgycWl1WkYybzc0MnZkL2JI\nTEVBREJwcjRCcS9Od0VHWTl3SHJFS1N2VDZPYWl2N2NXN0xmVFVtRUNOSFJq\nWCtYOGVRTXhNQ0E9PSIsImFsZyI6ImFlcy0yNTYtZ2NtK2VkMjU1MTkifQ==\n-----END LICENSE FILE-----\n";
const KEYGEN_LICENSE_KEY: &str = "988214-879010-F1185E-B37E91-E53AF5-V3";
const KEYGEN_PUBLIC_KEY: &str = "e8601e48b69383ba520245fd07971e983d06d22c4257cfd82304601479cee788";

#[derive(Deserialize, Debug)]
struct LicenseFile<'a> {
  enc: &'a str,
  sig: &'a str,
  alg: &'a str,
}

fn main() -> Result<(), Box<dyn Error>> {
  // Parse the hex-encoded public key.
  let public_key: PublicKey = match <[u8; PUBLIC_KEY_LENGTH]>::from_hex(KEYGEN_PUBLIC_KEY) {
    Ok(bytes) => PublicKey::from_bytes(&bytes)?,
    Err(_) => return Err("failed to parse public key".into()),
  };

  // Extract the encoded payload from the license file.
  let base64 = KEYGEN_LICENSE_FILE
    .replace("-----BEGIN LICENSE FILE-----", "")
    .replace("-----END LICENSE FILE-----", "")
    .replace('\n', "");

  // Decode the payload.
  let payload = match base64::decode(base64) {
    Ok(bytes) => String::from_utf8(bytes)?,
    Err(_) => return Err("failed to decode license file".into()),
  };

  // Parse the payload.
  let lic: LicenseFile = match serde_json::from_str(payload.as_str()) {
    Ok(json) => json,
    Err(_) => return Err("failed to parse license file".into()),
  };

  // Assert algorithm is supported.
  match lic.alg {
    "aes-256-gcm+ed25519" => (),
    _ => return Err("algorithm is not supported".into()),
  }

  // Verify the license file's signature.
  let msg = format!("license/{}", lic.enc);
  let sig: [u8; SIGNATURE_LENGTH] = match base64::decode(lic.sig)?.try_into() {
    Ok(sig) => sig,
    Err(_) => return Err("signature format is invalid".into()),
  };

  match public_key.verify(msg.as_bytes(), &sig.into()) {
    Ok(_) => (),
    Err(_) => return Err("license file is invalid".into()),
  }

  // Print license file.
  println!("license file was successfully verified!");
  println!("  > {:?}", lic);

  // Hash the license key to obtain decryption key.
  let mut sha = Sha256::new();

  sha.update(KEYGEN_LICENSE_KEY.as_bytes());

  let digest = sha.finalize();

  // Parse the encrypted data.
  let data: Vec<_> = lic.enc
    .trim()
    .split(".")
    .map(|v| base64::decode(v).expect("failed to parse encrypted data"))
    .collect();

  // Set up data and AES-GCM.
  let mut ciphertext = Vec::from(data[0].as_slice());
  let nonce = Nonce::from_slice(data[1].as_slice());
  let tag = Tag::from_slice(data[2].as_slice());
  let key = Key::from_slice(&digest);
  let aes = Aes256Gcm::new(key);

  // Concat authentication tag with ciphertext.
  ciphertext.extend_from_slice(tag);

  // Decrypt the license file.
  let plaintext = match aes.decrypt(nonce, ciphertext.as_ref()) {
    Ok(plaintext) => String::from_utf8(plaintext)?,
    Err(_) => return Err("failed to decrypt license file".into()),
  };

  // Print decrypted data.
  println!("license file was successfully decrypted!");
  println!("  > {}", plaintext);

  Ok(())
}
